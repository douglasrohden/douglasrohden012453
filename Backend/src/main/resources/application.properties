spring.application.name=backend

spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5433/dbmusicplayer}
spring.datasource.username=${POSTGRES_USER:postgres}
spring.datasource.password=${POSTGRES_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# Flyway
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
# Validate migrations to avoid schema drift
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

# Actuator - Health Checks & Liveness/Readiness Probes
management.endpoints.web.exposure.include=health,info,mappings,metrics,prometheus
management.endpoint.health.probes.enabled=true
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always

# Kubernetes Liveness & Readiness probe groups
management.endpoint.health.group.liveness.include=livenessState
management.endpoint.health.group.liveness.show-details=always
management.endpoint.health.group.readiness.include=readinessState,db
management.endpoint.health.group.readiness.show-details=always

# Enable disk space indicator
management.health.diskspace.enabled=true
# Enable database health indicator
management.health.db.enabled=true
# Disable mail health indicator to avoid actuator trying SMTP connection
management.health.mail.enabled=false

# Prevent Spring Boot from auto-configuring a MailSender (avoids SMTP auth at startup)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration

# JWT Configuration
# Secret key must be at least 256 bits (32 bytes)
# generate one using: openssl rand -base64 32
jwt.secret=${JWT_SECRET:404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970}
# 5 minutes in milliseconds
jwt.expiration=300000
# 7 days in milliseconds
jwt.refresh.expiration=604800000

# Refresh token cookie configuration (maps to README/.env)
security.refresh-cookie.name=${REFRESH_COOKIE_NAME:refreshToken}
security.refresh-cookie.secure=${REFRESH_COOKIE_SECURE:false}
security.refresh-cookie.same-site=${REFRESH_COOKIE_SAMESITE:Lax}

# Refresh token hardening
# Pepper for hashing refresh tokens stored in DB (defaults to jwt.secret if not provided)
refresh.token.pepper=${REFRESH_TOKEN_PEPPER:${jwt.secret}}

logging.level.com.douglasrohden.backend.config.filter.ApiRateLimitFilter=INFO

# Rate limit (edital: 10 req/min por usuario autenticado)
# Janela de 60s; bucket expira em 120s para evitar recálculo frequente.
rate-limit.requests-per-window=10
rate-limit.window-seconds=60
rate-limit.bucket-expire-after-seconds=120


# Enable debug logging for CORS and security during development
logging.level.org.springframework.web.filter.CorsFilter=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web.socket=DEBUG
logging.level.org.springframework.messaging=DEBUG
# Enable debug for rate-limit filter while diagnosing

server.port=${SERVER_PORT:3001}
server.address=${SERVER_ADDRESS:0.0.0.0}

server.error.include-message=always
server.error.include-binding-errors=always

spring.jpa.show-sql=false

# Logging - Stack traces mais curtos
# Default root level, overridable via Maven/system property -DLOGGING_LEVEL_ROOT
logging.level.root=${LOGGING_LEVEL_ROOT:INFO}
logging.level.com.douglasrohden=INFO
logging.level.com.douglasrohden.backend.config.filter.ApiRateLimitFilter=INFO
logging.level.org.hibernate=ERROR
logging.level.org.springframework.web=INFO
logging.level.org.apache.catalina=INFO

# Limitar profundidade do stack trace (mostra apenas 5 linhas)
server.error.include-stacktrace=never
logging.exception-conversion-word=%wEx{short}

# MinIO Storage
minio.endpoint=${MINIO_ENDPOINT:http://127.0.0.1:9000}
minio.access-key=${MINIO_ACCESS_KEY:minioadmin}
minio.secret-key=${MINIO_SECRET_KEY:minioadmin123}
minio.bucket=${MINIO_BUCKET:album-covers}
minio.region=${MINIO_REGION:us-east-1}
minio.presign.expiration-minutes=${MINIO_PRESIGN_EXPIRATION_MINUTES:30}
minio.max-file-size-bytes=${MINIO_MAX_FILE_SIZE_BYTES:5242880}
minio.allowed-content-types=image/jpeg,image/png,image/webp,image/gif

# Multipart limits (coerente com minio.max-file-size-bytes)
spring.servlet.multipart.max-file-size=${MINIO_MAX_FILE_SIZE_BYTES:5242880}B
spring.servlet.multipart.max-request-size=${MINIO_MAX_REQUEST_SIZE_BYTES:26214400}B

# Swagger UI custom path
springdoc.swagger-ui.path=/swagger-ui

# Integração externa - Regionais
integrador.regionais.url=${INTEGRADOR_REGIONAIS_URL:https://integrador-argus-api.geia.vip}
integrador.regionais.timeout.connect=${INTEGRADOR_REGIONAIS_TIMEOUT_CONNECT:3s}
integrador.regionais.timeout.read=${INTEGRADOR_REGIONAIS_TIMEOUT_READ:5s}

# CORS/WS (use esta propriedade em produção)
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:}
